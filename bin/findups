# -*- mode: python -*-
# -*- coding: utf-8 -*-

__author__ = "Silvano Cirujano Cuesta"
__email__ = "silvanociru@gmx.net"
__copyright__ = "Copyright (C) Silvano Cirujano Cuesta 2015"
__license__ = "MPL-2.0"

# Python standard packages
import os
import os.path
import logging
import argparse
import socket
import time
# findups packages
import findups.scanner


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--db_path', action="store",
                        default=os.path.join(os.getenv("HOME"), socket.gethostname() + ".db"),
                        help="Path of the DB")
    parser.add_argument('--debug', action="store_true",
                        help="Enable debugging")
    parser.add_argument('--accuracy', action="store", default=findups.scanner.SAME_SIZE,
                        help="Specify accuracy level")
    parser.add_argument('action', choices=['scan', 'merge', 'compare'],
                        help="Specify accuracy level")
    parser.add_argument('directory', action="store",
                        help="Path of the directory to scan")
    ns = parser.parse_args()
    if ns.debug:
        log_level = logging.DEBUG
    else:
        log_level = logging.WARNING
    accuracy = int(ns.accuracy)
    print("*****************************")
    if ns.action == 'scan':
        scanner = findups.scanner.DirScanner(db_path=ns.db_path, log_level=log_level, accuracy=accuracy)
        start = time.time()
        n_files, total_size = scanner.scan(ns.directory)
        end = time.time()
        duration = end - start
        print('%d files adding up to %d MBs have been scanned in %d seconds' %
              (n_files, int(total_size/(1024*1024)), duration))
        print('%d files/second' % (int(n_files/duration)))
    elif ns.action == 'merge':
        raise NotImplementedError
    elif ns.action == 'compare':
        raise NotImplementedError

if __name__ == '__main__':
    main()
